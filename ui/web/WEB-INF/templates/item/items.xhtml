<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~     Leibniz Bioactives Cloud
  ~     Copyright 2017 Leibniz-Institut f. Pflanzenbiochemie
  ~
  ~     Licensed under the Apache License, Version 2.0 (the "License");
  ~     you may not use this file except in compliance with the License.
  ~     You may obtain a copy of the License at
  ~
  ~         http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~     Unless required by applicable law or agreed to in writing, software
  ~     distributed under the License is distributed on an "AS IS" BASIS,
  ~     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~     See the License for the specific language governing permissions and
  ~     limitations under the License.
  ~
  ~
  ~
-->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:nwc="http://ipb-halle.de/nwc"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:crimsy="http://xmlns.jcp.org/jsf/composite/crimsy">
    <h:body>

        <crimsy:acobjectModal
            acobjectController="#{itemOverviewBean.acObjectController}"
            groupsAgent="#{groupAgent}"
            updateTargetClass="itemOverviewContainer"/>
        <h:form
            id="itemForm"
            class="outputContainer">
            <p:outputPanel
                id="itemOverviewContainerId"
                styleClass="itemOverviewContainer">

                <p:row>

                    <div style="display: flex; flex-direction: row;">

                        <p:outputPanel >
                            <p:outputPanel class="SearchField">

                                <!--Search Filter title-->
                                <!--*****************************************************************************************-->
                                <p:row>
                                    <p:outputPanel>
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_title}"
                                                      class="searchFilterHeader"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Material name-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel class="hello">
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_materialName}"
                                                      />
                                    </p:outputPanel>
                                </p:row>

                                <!--Inputfield material name-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel class="hello">
                                        <p:autoComplete value="#{itemOverviewBean.searchMaskValues.materialName}"
                                                        maxResults="10"
                                                        completeMethod="#{itemOverviewBean.getSimilarMaterialNames}"
                                                        class="itemFilterInputfield"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Label-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_label}"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Label Inputfield-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >

                                        <p:inputText
                                            value="#{itemOverviewBean.searchMaskValues.label}"
                                            styleClass="itemFilterInputfield"/>

                                    </p:outputPanel>
                                </p:row>

                                <!--User-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_user}"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--User Inputfied-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <p:autoComplete value="#{itemOverviewBean.searchMaskValues.userName}"
                                                        maxResults="10"
                                                        completeMethod="#{itemOverviewBean.getSimilarUserNames}"
                                                        class="itemFilterInputfield"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Project-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_project}"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Project Inputfield-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <p:autoComplete value="#{itemOverviewBean.searchMaskValues.projectName}"
                                                        maxResults="10"
                                                        completeMethod="#{itemOverviewBean.getSimilarProjectNames}"
                                                        class="itemFilterInputfield"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Location-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_location}"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Location Inputfield-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <p:autoComplete value="#{itemOverviewBean.searchMaskValues.location}"
                                                        maxResults="10"
                                                        forceSelection="true"
                                                        completeMethod="#{itemOverviewBean.getSimilarContainerNames}"
                                                        styleClass="itemFilterInputfield"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Remarks-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <h:outputText value="#{msgs.itemOverview_searchFilter_remarks}"/>
                                    </p:outputPanel>
                                </p:row>

                                <!--Remarks Inputfield-->
                                <!--*****************************************************************************************-->
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel >
                                        <p:inputText value="#{itemOverviewBean.searchMaskValues.description}"
                                                     styleClass="itemFilterInputfield"/>
                                    </p:outputPanel>
                                </p:row>


                                <p:row>
                                    <div style="display: flex; flex-direction: row;">

                                        <!--Clear button-->
                                        <!--*****************************************************************************************-->
                                        <p:outputPanel styleClass="itemFilterButtonColumn">

                                            <p:commandButton
                                                styleClass="itemFilterButton ui-button-secondary"
                                                value="#{msgs.itemOverview_searchFilter_clear}"
                                                ajax="true"
                                                process="@this"
                                                resetValues="true"
                                                update="itemForm"
                                                action="#{itemOverviewBean.actionClearSearchFilter()}"
                                                />
                                            <!--update="@(.ddr, .itemFilterInputfield, .hello)"-->
                                            <!--update="@searchFilter @(.itemOverviewContainer)"-->
                                            <!--onclick="ajax:itemOverviewBean.actionClearSearchFilter();"-->
                                        </p:outputPanel>

                                        <!--Search button-->
                                        <!--*****************************************************************************************-->
                                        <p:outputPanel styleClass="itemFilterButtonColumn itemFilterButtonRight">
                                            <p:commandButton
                                                styleClass="itemFilterButton"
                                                value="#{msgs.itemOverview_searchFilter_search}"
                                                process="@form"
                                                update="@(.itemOverviewTableContainer)"
                                                ajax="true"
                                                action="#{itemOverviewBean.actionApplySearchFilter()}"
                                                />
                                            <!--onclick="ajax:itemOverviewBean.actionApplySearchFilter();"-->
                                        </p:outputPanel>
                                    </div>
                                </p:row>
                            </p:outputPanel>

                            <!-- Reporting -->
                            <br />

                            <!--Create Report-->
                            <!--*****************************************************************************************-->
                            <p:row>
                                <p:outputPanel>
                                    <h:outputText
                                        value="#{msgs.reporting_createReport}"
                                        styleClass="searchFilterHeader" />
                                </p:outputPanel>
                            </p:row>

                            <!-- SelectOneMenu Report-->
                            <!--*****************************************************************************************-->
                            <div>
                                <p:row styleClass="itemFilterRow">
                                    <p:outputPanel>
                                        <p:selectOneMenu
                                            id="reportSelectionId"
                                            converter="omnifaces.SelectItemsConverter"
                                            styleClass="itemFilterInputfield"
                                            value="#{itemOverviewBean.selectedReport}">
                                            <f:selectItems
                                                value="#{itemOverviewBean.availableReports}"
                                                var="report"
                                                itemValue="#{report}"
                                                itemLabel="#{report.name}" />
                                        </p:selectOneMenu>
                                    </p:outputPanel>
                                </p:row>
                            </div>

                            <p:row>
                                <div style="display: flex; flex-direction: row;">

                                    <!-- SelectOneMenu ReportType: PDF/XLSX/CSV -->
                                    <!--*****************************************************************************************-->
                                    <p:outputPanel styleClass="itemFilterButtonColumn">
                                        <p:selectOneMenu
                                            id="reportType"
                                            value="#{itemOverviewBean.selectedReportType}"
                                            styleClass="itemFilterButton">
                                            <f:selectItems value="#{itemOverviewBean.reportTypes}" />
                                        </p:selectOneMenu>
                                    </p:outputPanel>

                                    <!--  Report Button-->
                                    <!--*****************************************************************************************-->
                                    <p:outputPanel styleClass="itemFilterButtonColumn itemFilterButtonRight">
                                        <p:commandButton
                                            ajax="true"
                                            process="reportSelectionId reportType"
                                            type="submit"
                                            update="growlMsg"
                                            action="#{itemOverviewBean.actionCreateReport()}"
                                            styleClass="itemFilterButton"
                                            value="#{msgs.reporting_report}" />
                                    </p:outputPanel>
                                </div>
                            </p:row>
                        </p:outputPanel>


                        <!-- Table-->
                        <!--*****************************************************************************************-->
                        <p:outputPanel >
                            <p:outputPanel styleClass="itemOverviewTableContainer">
                                <p:row>
                                    <p:outputPanel
                                        styleClass="itemDataTable">

                                        <!-- Paginator=Carusel-->
                                        <!--*****************************************************************************************-->
                                        <p:dataTable
                                            style="margin-left: 0.5rem;"
                                            paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                            rowsPerPageTemplate="5,10,30" 
                                            paginator="true" rows="50" 
                                            value="#{itemOverviewBean.items}"
                                            var="item">

                                            <!-- Label-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="Label">

                                                <h:outputText
                                                    id="itemLabel"
                                                    escape="false"
                                                    value="#{item.label}"
                                                    title="ID: #{item.id}" />
                                            </p:column>

                                            <!-- Material-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_material}">

                                                <h:panelGroup id="materialNames">
                                                    <ui:repeat value="#{item.material.names}"
                                                               size="#{nwc:min(item.material.names.size(), 3)}"
                                                               var="name"
                                                               varStatus="namesStatus">
                                                        <h:outputText value="#{name.value}" />
                                                        <ui:fragment rendered="#{!namesStatus.last}">
                                                            <br />
                                                        </ui:fragment>
                                                    </ui:repeat>
                                                </h:panelGroup>

                                                <p:tooltip for="materialNames" position="right">
                                                    <ui:repeat value="#{item.material.names}"
                                                               size="#{nwc:min(item.material.names.size(), 10)}"
                                                               var="name"
                                                               varStatus="namesStatus">
                                                        <h:outputText value="#{name.value}" />
                                                        <ui:fragment rendered="#{!namesStatus.last}">
                                                            <br />
                                                        </ui:fragment>
                                                    </ui:repeat>
                                                    <ui:fragment rendered="#{item.material.names.size() gt 10}">
                                                        ...
                                                    </ui:fragment>
                                                </p:tooltip>

                                            </p:column>

                                            <!-- Project Owner-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_projectOwner}">

                                                <h:outputFormat value="{0}/{1}">
                                                    <f:param value="#{item.project.name}" />
                                                    <f:param value="#{item.owner.name}" />
                                                </h:outputFormat>

                                            </p:column>

                                            <!-- Amount-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_amount}">

                                                <h:outputFormat value="{0} {1}">
                                                    <f:param value="#{nwc:formatAmount(item.amount)}" />
                                                    <f:param value="#{item.unit.unit}" />
                                                </h:outputFormat>

                                            </p:column>

                                            <!-- Location-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_location}">
                                                <h:outputText value="#{item.nestedLocation}"/>
                                            </p:column>

                                            <!-- Remarks-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_remarks}">

                                                <h:outputText value="#{item.description}"/>
                                            </p:column>

                                            <!-- Dates-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.itemOverview_tableheader_dates}">

                                                <h:outputText value="#{msgs.itemOverview_created}" />
                                                <h:outputText value="&#160;" />
                                                <br/>
                                                <h:outputText value="#{nwc:formatDateWithTimezone(item.cTime)}" />
                                                <h:outputText value="#{msgs.itemOverview_modified}"
                                                              rendered="#{!item.history.isEmpty()}" />
                                                <h:outputText value="&#160;" />
                                                <h:outputText value="#{nwc:formatDateWithTimezone(item.history.lastKey())}"
                                                              rendered="#{!item.history.isEmpty()}" />

                                            </p:column>

                                            <!-- Action-->
                                            <!--*****************************************************************************************-->
                                            <p:column headerText="#{msgs.materialOverview_tableheader_actions}" style="">

                                                <!-- ITEM EDITION-->
                                                <!--*****************************************************************************************-->
                                                <p:commandButton 
                                                    id="btnEdit"
                                                    icon="pi pi-pencil"
                                                    styleClass="ui-button-success"
                                                    type="submit"
                                                    process="@this"
                                                    update="@all"
                                                    ajax="true"
                                                    action="#{itemOverviewBean.actionStartItemEdit(item)}"
                                                    />
                                                <p:tooltip for="btnEdit" value="Edit Item Settings" position="top"/>

                                                <!-- GROUP PERMISSIONS-->
                                                <!--*****************************************************************************************-->
                                                <p:commandButton 
                                                    id="btnUser"
                                                    icon="pi pi-user"
                                                    ajax="true"
                                                    process="@this"
                                                    update="@(.mainPanel)"
                                                    type="submit"
                                                    oncomplete="PF('dlgAcl').show();"
                                                    disabled="#{itemOverviewBean.isEditDeactivated(item)}"
                                                    action="#{itemOverviewBean.actionStartAclChange(item)}"/>
                                                <!--update="@all"-->    

                                                <p:tooltip for="btnUser" value="#{msgs.collMgr_tooltip_changeUserPermission}" position="top"/>

                                                <!-- CREATE SOLUTION FROM ITEM-->
                                                <!--*****************************************************************************************-->
                                                <p:commandButton
                                                    id="btnFlask"
                                                    icon="fa fa-flask"
                                                    styleClass="ui-button-danger"
                                                    process="@this"
                                                    update="@all"
                                                    ajax="true"
                                                    disabled="#{createSolutionBean.isItemNotSoluble(item) or itemOverviewBean.isEditDeactivated(item)}"
                                                    action="#{createSolutionBean.actionStartCreateSolution(item)}"
                                                    />

                                                <p:tooltip for="btnFlask" value="#{msgs.itemOverview_tooltip_createSolution}" position="bottom"/>

                                                <!-- CREATE AN ALIQUOT FROM ITEM-->
                                                <!--*****************************************************************************************-->
                                                <p:commandButton
                                                    id="btnEyeDropper"
                                                    icon="fa fa-eyedropper"
                                                    styleClass="ui-button-danger"
                                                    ajax="true"
                                                    process="@this"
                                                    update="@all"
                                                    type="submit"
                                                    disabled="#{itemOverviewBean.isEditDeactivated(item)}"
                                                    action="#{createAliquotBean.actionStartCreateAliquot(item)}"
                                                    />

                                                <p:tooltip for="btnEyeDropper" value="#{msgs.itemOverview_tooltip_createAliquot}" position="bottom"/>


                                            </p:column>

                                        </p:dataTable>


                                    </p:outputPanel>
                                </p:row>
                                <p:row>
                                    <div style="display: flex; flex-direction: row;justify-content: center; ">

                                        <p:outputPanel  styleClass="itemNavigationColumn">
                                            <p:commandButton
                                                style="margin: 0.5rem -4.5rem; "
                                                disabled="#{itemOverviewBean.isBackDeactivated()}"
                                                icon="fa fa-fast-backward"
                                                ajax="true"
                                                process="@this"
                                                update="itemForm"
                                                action="#{itemOverviewBean.actionFirstItems()}"
                                                />
                                        </p:outputPanel>

                                        <p:outputPanel  styleClass="itemNavigationColumn">
                                            <p:commandButton
                                                style="margin: 0.5rem -1.5rem; "
                                                disabled="#{itemOverviewBean.isBackDeactivated()}"
                                                ajax="true"
                                                process="@this"
                                                update="itemForm"
                                                icon="fa fa-backward"
                                                action="#{itemOverviewBean.actionLastItems()}"/>
                                            <!--onclick="ajax:itemOverviewBean.actionLastItems();"-->
                                            <!--styleClass="itemNavigationButton"-->
                                        </p:outputPanel>

                                        <p:outputPanel  styleClass="itemNavigationColumn">
                                            <p:commandButton
                                                style="margin: 0.5rem 1.5rem; "
                                                disabled="#{itemOverviewBean.isForwardDeactivated()}"
                                                ajax="true"
                                                process="@this"
                                                update="itemForm"
                                                icon="fa fa-forward"
                                                action="#{itemOverviewBean.actionNextItems()}"
                                                />
                                            <!--styleClass="itemNavigationButton"-->
                                            <!--onclick="ajax:itemOverviewBean.actionNextItems();"-->
                                        </p:outputPanel>

                                        <p:outputPanel  styleClass="itemNavigationColumn">
                                            <p:commandButton
                                                style="margin: 0.5rem 4.5rem; "
                                                disabled="#{itemOverviewBean.isForwardDeactivated()}"
                                                ajax="true"
                                                process="@this"
                                                update="itemForm"
                                                icon="fa fa-fast-forward"
                                                action="#{itemOverviewBean.actionEndItems()}"
                                                />
                                            <!--styleClass="itemNavigationButton"-->
                                            <!--onclick="ajax:itemOverviewBean.actionEndItems();"-->
                                        </p:outputPanel>

                                        <p:outputPanel  style="margin: 1rem 8rem; ">
                                            <h:outputFormat
                                                value="#{msgs.itemOverview_itemsShownFormat}"
                                                rendered="#{itemOverviewBean.itemAmount gt 0}">
                                                <f:param value="#{itemOverviewBean.leftBorder}" />
                                                <f:param value="#{itemOverviewBean.rightBorder}" />
                                                <f:param value="#{itemOverviewBean.itemAmount}" />
                                            </h:outputFormat>

                                            <h:outputText

                                                value="#{msgs.itemOverview_noItemsFound}"
                                                rendered="#{itemOverviewBean.itemAmount le 0}" />
                                        </p:outputPanel>
                                    </div>

                                </p:row>
                            </p:outputPanel>
                        </p:outputPanel>
                    </div>
                </p:row>
            </p:outputPanel>
        </h:form>
    </h:body>
</html>
