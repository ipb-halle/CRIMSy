<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<!--

  Cloud Resource & Information Management System (CRIMSy)
  Copyright 2020 Leibniz-Institut f. Pflanzenbiochemie
  
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
      http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">


    <h:body>


        <ui:composition>
            <ui:insert name="fileupload">
                <ui:include src="/WEB-INF/templates/fileupload.xhtml"/>
            </ui:insert>

            <b:jumbotron id="jumboHeader" styleClass="defaultFormat">
                <b:row id="lbac_logo">
                    <b:image value="/resources/img/cloudlogo.svg"
                             id="cloudlogo"
                             styleClass="img-responsive,centerPanel"/>
                </b:row>
            </b:jumbotron>

            <b:row styleClass="defaultFormat">
                <b:column colMd="10"
                          offsetMd="1" 
                          colXs="10" 
                          >
                    <b:form horizontal="true" id="form1">
                        <b:poll id="searchPoll"
                                interval="#{documentSearchBean.getPollIntervall()}" 
                                update="form2:spinningIcon form2:newDocumentsBadge searchPoll form2:addDocumentButton"
                                actionListener="#{documentSearchBean.refreshDocumentsToShow}"/>

                        <b:poll id="refreshPollTable"
                                interval="#{documentSearchBean.getTableRefreshPollIntervall()}"
                                update="frmDocumentSearchResults refreshPollTable"
                                stop="#{documentSearchBean.getTableRefreshPollState()}" />

                        <b:inputText styleClass="searchRequest"
                                     placeholder=" #{msgs.searchMgr_searchtext_placeholder}"
                                     required="false" label=""
                                     value="#{searchBean.searchFilter.searchTerms}"
                                     labelColXs="0" labelColMd="0">

                            <f:facet name="prepend">
                                <b:iconAwesome name="cloud"/>
                            </f:facet>
                            <f:facet name="append">
                                <b:commandButton look="primary"
                                                 value=""
                                                 style="margin-left: 8px"
                                                 type="submit"
                                                 action="#{searchBean.actionTriggerSearch()}"
                                                 ajax="true"
                                                 update="@form frmDocumentSearchResults form2:spinningIcon form2:newDocumentsBadge searchPoll refreshPollTable"
                                                 icon="search"
                                                 icon-align="left"/>
                            </f:facet>
                        </b:inputText>

                    </b:form>
                </b:column>
                <b:column
                    col-xs="1"
                    col-lg="1"
                    col-md="1"
                    col-sm="1">
                    <b:form>
                        <b:commandButton
                            styleClass="advancedSearchButton"
                            ajax="true"
                            update="@(.advancedSearchPanel)"
                            action="#{searchBean.toogleAdvancedSearch()}"
                            icon-awesome="fa-plus-circle"/>


                    </b:form>
                </b:column>
                <b:column 
                    colMd="4"
                    offsetMd="4"
                    colXs="4"
                    offsetXs="4">
                    <b:button icon="cloud-upload"
                              value="#{msgs.searchMgr_uploadbutton}"
                              update="@none"
                              icon-size="2x"
                              look="info"
                              onclick="$('tbody.files').find('tr').remove();
                                      $('.modalFileUpload').modal()"
                              style="margin-top:10px" 
                              rendered="#{userBean.hasUploadPermission()}"/>
                </b:column>
            </b:row>
            <b:row
                styleClass="advancedSearchPanel">
                <b:column 
                    offset="1"
                    span="10"
                    rendered="#{searchBean.advancedSearch}">
                    <p:tabView styleClass="itemEditTabView">
                        <p:tab title="Common">

                        </p:tab>
                        <p:tab title="Types">
                            <b:row>
                                <b:column span="4">
                                    <b:row styleClass="advancedSearchHeader">
                                        <b:column span="2">
                                            <h:outputText
                                                value="Typen"/>
                                        </b:column>
                                    </b:row>
                                    <b:row>
                                        <b:column span="2"
                                                  styleClass="rightLabeledCbx">
                                            <b:selectBooleanCheckbox
                                                label="Materialien"/>
                                        </b:column>
                                    </b:row>
                                    <b:row>
                                        <b:column span="2"
                                                  styleClass="rightLabeledCbx">
                                            <b:selectBooleanCheckbox
                                                label="Gebinde"/>
                                        </b:column>
                                    </b:row>
                                    <b:row>
                                        <b:column span="2"
                                                  styleClass="rightLabeledCbx">
                                            <b:selectBooleanCheckbox
                                                label="Experimente"/>
                                        </b:column>
                                    </b:row>
                                    <b:row>
                                        <b:column span="2"
                                                  styleClass="rightLabeledCbx">
                                            <b:selectBooleanCheckbox
                                                label="Projekte"/>
                                        </b:column>
                                    </b:row>
                                </b:column>


                                <b:column span="4">
                                    <b:row>
                                        <b:column span="2">
                                            MaterialTypen
                                        </b:column>
                                    </b:row>
                                </b:column>         
                                <b:column span="4">
                                    Struktur
                                </b:column>          
                            </b:row>
                        </p:tab>
                        <p:tab title="Structure">

                        </p:tab>
                    </p:tabView>
                </b:column>
                <b:column 
                    span="11"
                    rendered="#{!searchBean.advancedSearch}">
                </b:column>
                <b:column span="1">
                    <b:form horizontal="true" id="form2">
                        <b:commandButton look="primary"
                                         styleClass="#{searchBean.getActualizeButtonStyleClass()}"
                                         tooltip="#{msgs.searchMgr_refreshButton_tooltip}"
                                         id="addDocumentButton"
                                         type="button"
                                         action="#{searchBean.actionAddFoundObjectsToShownObjects()}"
                                         ajax="true"
                                         update="frmDocumentSearchResults newDocumentsBadge spinningIcon form1:searchPoll addDocumentButton"
                                         icon-align="right"
                                         rendered="true"
                                         value="#{msgs.searchMgr_fetchButton}">
                            <b:badge 
                                style="margin-left: 4px"
                                styleClass="pc_badge"
                                id="newDocumentsBadge"
                                value="#{searchBean.getAmountOfNotShownObjects()}" />
                            <b:iconAwesome 
                                style="margin-left: 4px"
                                styleClass="pc_icon"
                                id="spinningIcon"
                                name="refresh"
                                spin="#{searchBean.isSearchActive()}"
                                size="1x" />#{'   '}
                        </b:commandButton>
                    </b:form>
                </b:column>
            </b:row>
            <b:row  styleClass="defaultFormat">
                <b:form id="frmDocumentSearchResults">
                    <b:dataTable
                        var="searchable"
                        value="#{searchBean.shownObjects}">
                        <b:dataTableColumn
                            label="Name">
                            <b:navLink
                                href="#{searchBean.netObjectPresenter.getLink(searchable)}" 
                                value="#{searchBean.netObjectPresenter.getName(searchable)}"
                                rendered="#{searchBean.netObjectPresenter.isDownloadLinkVisible(searchable)}"
                                />
                            <b:commandLink
                                href="#{searchBean.netObjectPresenter.getLink(searchable)}" 
                                action="#{searchBean.navigateToObject(searchable)}"
                                value="#{searchBean.netObjectPresenter.getName(searchable)}"
                                rendered="#{searchBean.netObjectPresenter.isInternalLinkVisible(searchable)}"
                                />
                            <b:commandLink
                                href="#{searchBean.netObjectPresenter.getLink(searchable)}" 
                                action="#{searchBean.navigateToObject(searchable)}"
                                value="#{searchBean.netObjectPresenter.getName(searchable)}"
                                rendered="#{searchBean.netObjectPresenter.isExternalLinkVisible(searchable)}"
                                />

                        </b:dataTableColumn>
                        <b:dataTableColumn
                            label="Location"
                            value="#{searchBean.netObjectPresenter.getNodeName(searchable)}"/>
                        <b:dataTableColumn
                            label="Type"
                            value="#{searchBean.netObjectPresenter.getObjectType(searchable)}"/>
                        <b:dataTableColumn
                            label="Relevanz"
                            value="#{searchBean.netObjectPresenter.getObjectRelevance(searchable)}"/>
                    </b:dataTable>

                </b:form>
            </b:row>

        </ui:composition>
    </h:body>
</html>
